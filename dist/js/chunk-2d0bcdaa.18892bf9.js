(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0bcdaa"],{"2a05":function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"diy_edit page_redemption_records",attrs:{id:"redemption_records_edit"}},[t("div",{staticClass:"warp"},[t("div",{staticClass:"container"},[t("div",{staticClass:"row diy_edit_content_box"},[e.$check_field("set","exchange_number")||e.$check_field("add","exchange_number")||e.$check_field("get","exchange_number")?t("div",{staticClass:"form-item col-12 col-md-6"},[e._m(0),t("div",{staticClass:"diy_field diy_text"},[e.form["exchange_number"]&&e.$check_field("set","exchange_number")||!e.form["exchange_number"]&&e.$check_field("add","exchange_number")?t("input",{directives:[{name:"model",rawName:"v-model",value:e.form["exchange_number"],expression:"form['exchange_number']"}],attrs:{type:"text",id:"form_exchange_number",placeholder:"请输入兑换号",disabled:!0},domProps:{value:e.form["exchange_number"]},on:{input:function(t){t.target.composing||e.$set(e.form,"exchange_number",t.target.value)}}}):e.$check_field("get","exchange_number")?t("span",[e._v(e._s(e.form["${obj.name}"]))]):e._e()])]):e._e(),e.$check_field("set","product_number")||e.$check_field("add","product_number")||e.$check_field("get","product_number")?t("div",{staticClass:"form-item col-12 col-md-6"},[e._m(1),t("div",{staticClass:"diy_field diy_text"},[e.form["product_number"]&&e.$check_field("set","product_number")||!e.form["product_number"]&&e.$check_field("add","product_number")?t("input",{directives:[{name:"model",rawName:"v-model",value:e.form["product_number"],expression:"form['product_number']"}],attrs:{type:"text",id:"form_product_number",placeholder:"请输入商品编号",disabled:e.disabledObj["product_number_isDisabled"]},domProps:{value:e.form["product_number"]},on:{input:function(t){t.target.composing||e.$set(e.form,"product_number",t.target.value)}}}):e.$check_field("get","product_number")?t("span",[e._v(e._s(e.form["${obj.name}"]))]):e._e()])]):e._e(),e.$check_field("set","product_name")||e.$check_field("add","product_name")||e.$check_field("get","product_name")?t("div",{staticClass:"form-item col-12 col-md-6"},[e._m(2),t("div",{staticClass:"diy_field diy_text"},[e.form["product_name"]&&e.$check_field("set","product_name")||!e.form["product_name"]&&e.$check_field("add","product_name")?t("input",{directives:[{name:"model",rawName:"v-model",value:e.form["product_name"],expression:"form['product_name']"}],attrs:{type:"text",id:"form_product_name",placeholder:"请输入商品名称",disabled:e.disabledObj["product_name_isDisabled"]},domProps:{value:e.form["product_name"]},on:{input:function(t){t.target.composing||e.$set(e.form,"product_name",t.target.value)}}}):e.$check_field("get","product_name")?t("span",[e._v(e._s(e.form["${obj.name}"]))]):e._e()])]):e._e(),e.$check_field("set","product_type")||e.$check_field("add","product_type")||e.$check_field("get","product_type")?t("div",{staticClass:"form-item col-12 col-md-6"},[e._m(3),t("div",{staticClass:"diy_field diy_text"},[e.form["product_type"]&&e.$check_field("set","product_type")||!e.form["product_type"]&&e.$check_field("add","product_type")?t("input",{directives:[{name:"model",rawName:"v-model",value:e.form["product_type"],expression:"form['product_type']"}],attrs:{type:"text",id:"form_product_type",placeholder:"请输入商品类型",disabled:e.disabledObj["product_type_isDisabled"]},domProps:{value:e.form["product_type"]},on:{input:function(t){t.target.composing||e.$set(e.form,"product_type",t.target.value)}}}):e.$check_field("get","product_type")?t("span",[e._v(e._s(e.form["${obj.name}"]))]):e._e()])]):e._e(),e.$check_field("set","product_specifications")||e.$check_field("add","product_specifications")||e.$check_field("get","product_specifications")?t("div",{staticClass:"form-item col-12 col-md-6"},[e._m(4),t("div",{staticClass:"diy_field diy_text"},[e.form["product_specifications"]&&e.$check_field("set","product_specifications")||!e.form["product_specifications"]&&e.$check_field("add","product_specifications")?t("input",{directives:[{name:"model",rawName:"v-model",value:e.form["product_specifications"],expression:"form['product_specifications']"}],attrs:{type:"text",id:"form_product_specifications",placeholder:"请输入商品规格",disabled:e.disabledObj["product_specifications_isDisabled"]},domProps:{value:e.form["product_specifications"]},on:{input:function(t){t.target.composing||e.$set(e.form,"product_specifications",t.target.value)}}}):e.$check_field("get","product_specifications")?t("span",[e._v(e._s(e.form["${obj.name}"]))]):e._e()])]):e._e(),e.$check_field("set","required_points")||e.$check_field("add","required_points")||e.$check_field("get","required_points")?t("div",{staticClass:"form-item col-12 col-md-6"},[e._m(5),t("div",{staticClass:"diy_field diy_number"},[e.form["required_points"]&&e.$check_field("set","required_points")||!e.form["required_points"]&&e.$check_field("add","required_points")?t("input",{directives:[{name:"model",rawName:"v-model.number",value:e.form["required_points"],expression:"form['required_points']",modifiers:{number:!0}}],attrs:{type:"number",id:"form_required_points",placeholder:"请输入所需积分",disabled:e.disabledObj["required_points_isDisabled"]},domProps:{value:e.form["required_points"]},on:{input:function(t){t.target.composing||e.$set(e.form,"required_points",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}):e.$check_field("get","required_points")?t("span",[e._v(e._s(e.form["${obj.name}"]))]):e._e()])]):e._e(),e.$check_field("set","redemption_date")||e.$check_field("add","redemption_date")||e.$check_field("get","redemption_date")?t("div",{staticClass:"form-item col-12 col-md-6"},[e._m(6),t("div",{staticClass:"diy_field diy_date"},[e.form["redemption_date"]&&e.$check_field("set","redemption_date")||!e.form["redemption_date"]&&e.$check_field("add","redemption_date")?t("input",{directives:[{name:"model",rawName:"v-model",value:e.form["redemption_date"],expression:"form['redemption_date']"}],attrs:{type:"date",disabled:e.disabledObj["redemption_date_isDisabled"],id:"form_redemption_date",placeholder:"请输入兑换日期"},domProps:{value:e.form["redemption_date"]},on:{input:function(t){t.target.composing||e.$set(e.form,"redemption_date",t.target.value)}}}):e.$check_field("get","redemption_date")?t("span",[e._v(e._s(e.form["${obj.name}"]))]):e._e()])]):e._e(),e.$check_field("set","ordinary_users")||e.$check_field("add","ordinary_users")||e.$check_field("get","ordinary_users")?t("div",{staticClass:"form-item col-12 col-md-6"},[e._m(7),t("div",{staticClass:"diy_field diy_down"},[e.form["ordinary_users"]&&e.$check_field("set","ordinary_users")||!e.form["ordinary_users"]&&e.$check_field("add","ordinary_users")?t("select",{directives:[{name:"model",rawName:"v-model",value:e.form["ordinary_users"],expression:"form['ordinary_users']"}],attrs:{id:"form_ordinary_users",disabled:e.disabledObj["ordinary_users_isDisabled"]},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.form,"ordinary_users",t.target.multiple?r:r[0])}}},e._l(e.list_user_ordinary_users,(function(r){return t("option",{domProps:{value:r["user_id"]}},[e._v(" "+e._s(r["nickname"]+"-"+r["username"])+" ")])})),0):e.$check_field("get","ordinary_users")?t("span",[e._v(e._s(e.form["ordinary_users"]))]):e._e()])]):e._e()]),t("div",{staticClass:"diy_edit_submit_box row"},[t("div",{staticClass:"col-12"},[t("div",{staticClass:"btn_box"},[t("button",{staticClass:"btn_submit",on:{click:function(t){return e.submit()}}},[e._v("提交")])])])])])])])},s=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"diy_title"},[t("span",[e._v(" 兑换号: ")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"diy_title"},[t("span",[e._v(" 商品编号: ")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"diy_title"},[t("span",[e._v(" 商品名称: ")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"diy_title"},[t("span",[e._v(" 商品类型: ")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"diy_title"},[t("span",[e._v(" 商品规格: ")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"diy_title"},[t("span",[e._v(" 所需积分: ")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"diy_title"},[t("span",[e._v(" 兑换日期: ")])])},function(){var e=this,t=e._self._c;return t("div",{staticClass:"diy_title"},[t("span",[e._v(" 普通用户: ")])])}],d=r("c6e7"),o={mixins:[d["a"]],components:{},data(){return{url_get_obj:"~/api/redemption_records/get_obj?",url_add:"~/api/redemption_records/add?",url_set:"~/api/redemption_records/set?",oauth:{signIn:!0,user_group:[]},query:{exchange_number:"",product_number:"",product_name:"",product_type:"",product_specifications:"",required_points:0,redemption_date:"",ordinary_users:0,redemption_records_id:0},obj:{exchange_number:this.$get_stamp(),product_number:"",product_name:"",product_type:"",product_specifications:"",required_points:0,redemption_date:(new Date).getTime(),ordinary_users:0,redemption_records_id:0,user_id:this.$store.state.user.user_id},form:{exchange_number:this.$get_stamp(),product_number:"",product_name:"",product_type:"",product_specifications:"",required_points:0,redemption_date:(new Date).getTime(),ordinary_users:0,redemption_records_id:0,user_id:this.$store.state.user.user_id},disabledObj:{exchange_number_isDisabled:!1,product_number_isDisabled:!1,product_name_isDisabled:!1,product_type_isDisabled:!1,product_specifications_isDisabled:!1,redemption_date_isDisabled:!1,ordinary_users_isDisabled:!1},list_user_ordinary_users:[],field:"redemption_records_id",limit_times:0,limit_type:0,act_limit_times:0}},methods:{submit_check(e){return this.act_limit_times>=this.limit_times?"已超过提交次数":null},check_limit(){let e=this;"管理员"===e.$store.state.user.user_group?e.limit_times=999:e.$get("~/api/point_products/get_obj?",{product_number:e.form.product_number},(function(t){if(t.result&&t.result.obj){e.limit_times=t.result.obj.limit_times,e.limit_type=t.result.obj.limit_type;let r=e.$store.state.user.user_id,i="~/api/redemption_records/count?product_number="+e.form.product_number+"&user_id="+r;if(1===e.limit_type){let t=e.$toTime(parseInt((new Date).getTime()),"yyyy-MM-dd"),r="&create_time_min="+t+" 00:00:00&create_time_max="+t+" 23:59:59";i+=r}e.$get(i,{},(function(t){e.act_limit_times=t.result}))}}))},async get_list_user_ordinary_users(){var e=await this.$get("~/api/user/get_list?user_group=普通用户");e.result&&e.result.list?this.list_user_ordinary_users=e.result.list:e.error&&console.error(e.error)},async get_user_session_ordinary_users(){var e=this,t=await this.$get("~/api/user_group/get_obj?name=普通用户");if(t.result&&t.result.obj){var r=t.result.obj.source_table,i=e.$store.state.user.user_id;if(i){var s="~/api/"+r+"/get_obj?";this.$get(s,{user_id:e.$store.state.user.user_id},(function(t){if(t.result&&t.result.obj){var r=[];for(let e in t.result.obj)r.push(e);var s=[];for(let t in e.form)s.push(t);e.form["ordinary_users"]=i,e.disabledObj["ordinary_users_isDisabled"]=!0;for(var d=0;d<r.length;d++)if("examine_state"!==r[d]&&"examine_reply"!==r[d])for(var o=0;o<s.length;o++)if(r[d]===s[o]&&"ordinary_users"!==r[d]){e.form[s[o]]=t.result.obj[r[d]],e.disabledObj[s[o]+"_isDisabled"]=!0;break}}}))}}else t.error&&console.error(t.error)},change_file(e,t){var r=new FormData;r.append("file",e[0]),this.$post("~/api/redemption_records/upload?",r,e=>{e.result?this.form[t]=e.result.url:e.error&&this.$toast(e.error.message)})},get_obj_before(e){var t=$.db.get("form");if(t){var r=[];for(let e in t)r.push(e);var i=[];for(let e in this.form)i.push(e);for(var s=0;s<r.length;s++)if("examine_state"!==r[s]&&"examine_reply"!==r[s])for(var d=0;d<i.length;d++)if(i[d]===r[s]){this.form[i[d]]=t[r[s]],this.obj[i[d]]=t[r[s]],this.disabledObj[i[d]+"_isDisabled"]=!0;break}}return-1===JSON.stringify(this.form["redemption_date"]).indexOf("-")&&(this.form["redemption_date"]=this.$toTime(parseInt(this.form["redemption_date"]),"yyyy-MM-dd")),$.db.del("form"),e},get_obj_after(e,t){t&&t(e)}},created(){this.get_user_session_ordinary_users(),this.get_list_user_ordinary_users()},watch:{"form.product_number":{handler:function(){this.check_limit()}}}},_=o,a=r("0b56"),c=Object(a["a"])(_,i,s,!1,null,null,null);t["default"]=c.exports}}]);
//# sourceMappingURL=chunk-2d0bcdaa.18892bf9.js.map