(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-72829e79"],{"1cc1":function(t,s,e){"use strict";e("7bd4")},"684a":function(t,s,e){},"7bd4":function(t,s,e){},bdb6:function(t,s,e){"use strict";e.r(s);var i=function(){var t=this,s=t._self._c;return s("div",{staticClass:"page_cart",attrs:{id:"cart_index"}},[s("div",{staticClass:"warp"},[s("div",{staticClass:"container"},[s("div",{staticClass:"row"},[s("div",{staticClass:"col"},[s("div",{staticClass:"card"},[s("h4",[t._v("我的购物车")]),s("list_cart",{attrs:{list:t.list}})],1),s("button",{on:{click:function(s){return t.del()}}},[t._v("删除")])])])])])])},a=[],c=e("c6e7"),l=function(){var t=this,s=t._self._c;return s("div",{staticClass:"cart_block"},[s("div",{staticClass:"list_cart"},t._l(t.list,(function(e,i){return s("div",{key:i,staticClass:"item_cart"},[s("div",{staticClass:"choose_btn",class:{active:e[t.vm.selected]},on:{click:function(s){return t.select_func(e,i)}}},[s("div",{staticClass:"btn_circle"},[s("span",{staticClass:"icon_wrap"},[e[t.vm.selected]?s("b-icon",{attrs:{icon:"check"}}):t._e()],1)])]),s("div",{staticClass:"cart_body"},[s("div",{staticClass:"img_block"},[s("img",{attrs:{src:t.$fullUrl(e[t.vm.img])}})]),s("div",{staticClass:"right_info"},[s("div",{staticClass:"title ellipsis_2"},[t._v(" "+t._s(e[t.vm.title])+" ")]),s("div",{staticClass:"btn_del",on:{click:function(s){return t.del_cart(e,i)}}},[s("b-icon",{staticClass:"icon_del",attrs:{type:"trash",color:"var(--color_grey)",icon:"trash"}})],1),s("div",{staticClass:"bottom_price"},[s("div",{staticClass:"price"},[s("span",[t._v("￥"+t._s(e[t.vm.price]))]),s("span",{staticClass:"price_ago"},[t._v("￥"+t._s(e[t.vm.price_ago]))])]),s("div",{staticClass:"handle_num"},[s("div",{staticClass:"subtract",on:{click:function(s){return t.sub_num(e,i)}}},[s("span",[t._v("-")])]),s("div",{staticClass:"num"},[t._v(" "+t._s(e[t.vm.num])+" ")]),s("div",{staticClass:"add",on:{click:function(s){return t.add_num(e)}}},[s("span",[t._v("+")])])])])])])])})),0),t.$check_action("/order/list","add")?s("div",{staticClass:"bar_settle"},[s("div",{staticClass:"choose_btn",class:{active:t.select_all_flag},on:{click:function(s){return t.select_all()}}},[s("div",{staticClass:"btn_circle"},[t.select_all_flag?s("b-icon",{staticStyle:{color:"#fff","font-size":"0.3rem"},attrs:{icon:"check"}}):t._e()],1),s("span",[t._v("全选")])]),s("div",{staticClass:"right_settle"},[s("div",{staticClass:"sum_block"},[s("span",[t._v("共计：")]),s("span",{staticClass:"sum"},[t._v("￥"+t._s(t.count()))])]),s("div",{staticClass:"settle"},[s("button",{staticClass:"btn_settle",attrs:{color:"#fff",size:"mini"},on:{click:function(s){return t.settle_all()}}},[t._v(" 购买 ")])])])]):t._e()])},r=[],n=(e("4ff3"),{props:{list:{type:Array,default:function(){return[]}},vm:{type:Object,default:function(){return{cart_id:"cart_id",title:"title",img:"img",user_id:"user_id",state:"state",price:"price",price_ago:"price_ago",price_count:"price_count",num:"num",goods_id:"goods_id",description:"description",selected:"selected"}}}},data(){return{sum_price:0,select_all_flag:!1}},computed:{},methods:{count(){var t=0;return this.list.map(s=>{s.selected&&(t=parseFloat(t)+parseFloat(s.price_count))}),t},selectedAll(){return this.list.every(t=>t.selected)},add_num(t){var{cart_id:s,num:e,price:i,price_count:a}=t;e=parseInt(e)+1,a=parseFloat(a)+parseFloat(i),this.$post("~/api/cart/set?cart_id="+s,{num:e,price:i,price_count:a},t=>{this.list.map(t=>{t.cart_id===s&&(t.num=e,t.price_count=a)})})},sub_num(t,s){var{cart_id:e,num:i,price:a,price_count:c}=t;i=parseInt(i)-1,c=parseFloat(c)-parseFloat(a),0===i?this.$get("~/api/cart/del?cart_id="+e,{},t=>{this.list.splice(s,1)}):this.$post("~/api/cart/set?cart_id="+e,{num:i,price:a,price_count:c},t=>{this.list.map(t=>{t.cart_id===e&&(t.num=i,t.price_count=c)})})},del_cart(t,s){this.$get("~/api/cart/del?cart_id="+t.cart_id,{},t=>{this.list.splice(s,1)})},select_func(t,s){t.selected=!t.selected,this.$set(this.list,s,t),this.select_all_flag=this.selectedAll()},select_all(){this.selectedAll()?(this.list.map(t=>{t.selected=!1}),this.select_all_flag=!1):(this.list.map(t=>{t.selected=!0}),this.select_all_flag=!0)},order_code(){for(var t="",s=0;s<6;s++)t+=Math.floor(10*Math.random());return t=(new Date).getTime()+t,t},async settle_one(t,s,e,i){var{title:a,img:c,price:l,price_ago:r,price_count:n,num:o,type:_,goods_id:d,description:u,user_id:p,cart_id:h}=t,v={order_number:e,title:a,img:c,price:l,price_ago:r,price_count:n,num:o,type:_,goods_id:d,description:u,contact_name:i.obj.name,contact_phone:i.obj.phone,contact_address:i.obj.address,postal_code:i.obj.postcode,user_id:p};console.log(v),await new Promise((t,s)=>{this.$post("~/api/order/add?",v,s=>{s.result&&t()})}),await new Promise((t,e)=>{this.$get("~/api/cart/del?",{cart_id:h},e=>{e.result&&(this.list.splice(s,1),t())})})},async settle_all(){let t=!1;for(let e=0;e<this.list.length;e++)if(this.list[e].selected){let s=await this.$get("~/api/goods/get_obj?",{goods_id:this.list[e].goods_id});if(s.result&&s.result.obj&&this.list[e].num>s.result.obj.inventory){t=!0,this.$toast("库存不足");break}}if(!t){var s=this.order_code();this.$get("~/api/address/get_obj?",{user_id:this.$store.state.user.user_id,default:1},t=>{if(t.result&&t.result.obj){console.log(t.result);this.list.map(async(e,i)=>{e.selected&&(await this.settle_one(e,i,s,t.result),this.$router.push("/order/details?order_number="+s))});this.$toast("加入订单成功")}else this.$toast("地址未添加")})}},is_wx_env(){var t=window.navigator.userAgent.toLowerCase();var s=!1;return t.match(/MicroMessenger/i),s}}}),o=n,_=(e("beea"),e("0b56")),d=Object(_["a"])(o,l,r,!1,null,"3142ec1f",null),u=d.exports,p={mixins:[c["a"]],components:{list_cart:u},data(){return{url_get_list:"~/api/cart/get_list?",list:[],query:{page:1,size:10},list_cart_type:[]}},methods:{get_list_before(t){return t.user_id=this.user.user_id,t},get_list_after(t){return t.result.list.map(t=>{t.selected=!1})},del(){for(let t=0;t<this.list.length;t++)this.list[t].selected&&this.$get("~/api/cart/del?cart_id="+this.list[t].cart_id,{},s=>{this.list.splice(t,1),t--})}}},h=p,v=(e("1cc1"),Object(_["a"])(h,i,a,!1,null,"16cc0548",null));s["default"]=v.exports},beea:function(t,s,e){"use strict";e("684a")}}]);
//# sourceMappingURL=chunk-72829e79.cfc7e1e4.js.map